<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog 
	xmlns="http://www.liquibase.org/xml/ns/dbchangelog" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xmlns:n0="http://www.oracle.com/xml/ns/dbchangelog-ext" 
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog 
	http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">
	<changeSet id="26f05a9ba48c39d015aa582f505dbffe966a6550" author="(HHA_PROD)-Generated"     >
		<n0:createOracleProcedure objectName="ZACTA_RECEIPT_IN_VSS" objectType="PROCEDURE" ownerName="HHA_PROD"   >
			<n0:source><![CDATA[
  CREATE OR REPLACE EDITIONABLE PROCEDURE "HHA_PROD"."ZACTA_RECEIPT_IN_VSS" (loc number,RECEIPT_REMARKS_ varchar2,RECEIPT_CUSTOMER_NAME_ENG_ varchar2,RECEIPT_AMOUNT_ number,RECEIPT_TYPE_ number,
PAYMENT_MODE_ number,CHEQUE_NO_ varchar2,
CHEQUE_DATE_ date,APPROVAL_NO_ varchar2,BANK_CODE_ varchar2,VAT_FLAG_ varchar2,VAT_AMOUNT_ number,AMOUNT_WITHOUT_VAT_ number,REG_PLATE_AMOUNT_ number,
ZATCA_INV_NO_ number,PROMISE_DEL_DATE_ date)   is 


RECEIPT_ID_ number;
INVOICE_NUMBER_ number;

begin

--21433146
   SELECT MAX(RECEIPT_ID)+1 into RECEIPT_ID_  FROM VSS_USER.VSS_CASH_RECEIPT@TO_APPIDEV.HHA.LOCAL   WHERE RECEIPT_BRANCH_CODE=loc;
   SELECT INVOICE_NUMBER +1 into INVOICE_NUMBER_    FROM VSS_USER.VSS_CASH_RECEIPT_SNO@TO_APPIDEV.HHA.LOCAL   WHERE LOCATION=loc  for update of invoice_number;

insert into vss_cash_receipt@TO_APPIDEV.HHA.LOCAL (RECEIPT_ID,RECEIPT_NO,RECEIPT_AMOUNT,RECEIPT_DATE,RECEIPT_REMARKS,RECEIPT_PARTIAL_FLAG,RECEIPT_REVERSAL_FLAG,
RECEIPT_VSS_FLAG,RECEIPT_CUSTOMER_NAME_ENG,RECEIPT_BRANCH_CODE,RECEIPT_TYPE,PAYMENT_MODE,CHEQUE_NO,CHEQUE_DATE,CREDIT_CARD_NO,APPROVAL_NO,
BANK_CODE,CREATED_BY,CREATED_DATE,GRANTED_BRANCH_CODE,AR_CUSTOMER_NO,VAT_FLAG,VAT_AMOUNT,AMOUNT_WITHOUT_VAT,REG_PLATE_AMOUNT,
VAT_USED_FLAG,ZATCA_INV_NO,PROMISE_DEL_DATE) 
values (RECEIPT_ID_,INVOICE_NUMBER_,RECEIPT_AMOUNT_,sysdate,RECEIPT_REMARKS_,'N','N','N',RECEIPT_CUSTOMER_NAME_ENG_,
loc,RECEIPT_TYPE_,PAYMENT_MODE_,
'CHEQUE_NO_',CHEQUE_DATE_,null,APPROVAL_NO_, BANK_CODE_,2634,sysdate,loc,null,VAT_FLAG_,VAT_AMOUNT_,AMOUNT_WITHOUT_VAT_,REG_PLATE_AMOUNT_,
'N',ZATCA_INV_NO_,PROMISE_DEL_DATE_+20
);

    UPDATE VSS_USER.VSS_CASH_RECEIPT_SNO@TO_APPIDEV.HHA.LOCAL SET INVOICE_NUMBER=INVOICE_NUMBER + 1 WHERE LOCATION=loc;
  
--    select * from  VSS_USER.VSS_CASH_RECEIPT_SNO --SET INVOICE_NUMBER=INVOICE_NUMBER + 1
  --   WHERE LOCATION=214

end;
/]]></n0:source>
		</n0:createOracleProcedure>
	</changeSet>
</databaseChangeLog>
