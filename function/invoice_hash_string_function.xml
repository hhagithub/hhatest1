<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog 
	xmlns="http://www.liquibase.org/xml/ns/dbchangelog" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xmlns:n0="http://www.oracle.com/xml/ns/dbchangelog-ext" 
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog 
	http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">
	<changeSet id="bb3938c2b3597d71d45728a87a131b92e7bf4201" author="(HHA_PROD)-Generated"     >
		<n0:createOracleFunction objectName="INVOICE_HASH_STRING" objectType="FUNCTION" ownerName="HHA_PROD"   >
			<n0:source><![CDATA[
  CREATE OR REPLACE EDITIONABLE FUNCTION "HHA_PROD"."INVOICE_HASH_STRING" RETURN clob IS
 h raw(32);
 cb clob;
 cb1 clob;
 cb2 clob;
 l_hash  raw(2000);
 v_output clob;
 V_RAW raw(20000);
 v_xml xmltype;

BEGIN

--SELECT XMLSERIALIZE ( CONTENT extract(xml, '/Invoice') ) into v_output FROM xdata;
--select DBMS_XMLGEN.getxml(xml) from zatca-xml
--DBMS_XMLGEN.CONVERT (xmlData IN CLOB,flag    IN NUMBER := ENTITY_ENCODE) RETURN CLOB;
--select trim(xmlserialize( content xmltype(xml) as clob  INDENT )) into cb from zatca_xml;
--select (xmlserialize(document xmltype(ZATCA_XML_ID(100)))) from dual;
--SELECT DBMS_XMLGEN.CONVERT((SELECT XML FROM ZATCA_XML),1) INTO CB FROM DUAL;
--v_xmldata.getClobVal();
--select (xmlserialize(document xmltype(xml))) into cb from zatca_xml;



-- cb2:= '<Invoice xmlns="urn:oasis:names:specification:ubl:schema:xsd:Invoice-2" xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2" xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2" xmlns:ext="urn:oasis:names:specification:ubl:schema:xsd:CommonExtensionComponents-2"> <cbc:ProfileID>reporting:1.0</cbc:ProfileID> <cbc:ID>100</cbc:ID> <cbc:UUID>3cf5ee18-ee25-44ea-a444-2c37ba7f28be</cbc:UUID> <cbc:IssueDate>2021-04-25</cbc:IssueDate> <cbc:IssueTime>15:30:00</cbc:IssueTime> <cbc:InvoiceTypeCode name="0100000">388</cbc:InvoiceTypeCode> <cbc:DocumentCurrencyCode>SAR</cbc:DocumentCurrencyCode> <cbc:TaxCurrencyCode>SAR</cbc:TaxCurrencyCode> <cbc:LineCountNumeric>2</cbc:LineCountNumeric> <cac:AdditionalDocumentReference> <cbc:ID>ICV</cbc:ID> <cbc:UUID>46531</cbc:UUID> </cac:AdditionalDocumentReference> <cac:AdditionalDocumentReference> <cbc:ID>PIH</cbc:ID> <cac:Attachment> <cbc:EmbeddedDocumentBinaryObject mimeCode="text/plain">NWZlY2ViNjZmZmM4NmYzOGQ5NTI3ODZjNmQ2OTZjNzljMmRiYzIzOWRkNGU5MWI0NjcyOWQ3M2EyN2ZiNTdlOQ==</cbc:EmbeddedDocumentBinaryObject> </cac:Attachment> </cac:AdditionalDocumentReference> <cac:AccountingSupplierParty> <cac:Party> <cac:PartyIdentification> <cbc:ID schemeID="MLS">123457890</cbc:ID> </cac:PartyIdentification> <cac:PostalAddress> <cbc:StreetName>Bab makkah</cbc:StreetName> <cbc:BuildingNumber>1234</cbc:BuildingNumber> <cbc:PlotIdentification>1234</cbc:PlotIdentification> <cbc:CitySubdivisionName>Bab Makkah</cbc:CitySubdivisionName> <cbc:CityName>Jeddah</cbc:CityName> <cbc:PostalZone>12643</cbc:PostalZone> <cbc:CountrySubentity>Makkah Region</cbc:CountrySubentity> <cac:Country> <cbc:IdentificationCode>SA</cbc:IdentificationCode> </cac:Country> </cac:PostalAddress> <cac:PartyTaxScheme> <cbc:CompanyID>312345678900003</cbc:CompanyID> <cac:TaxScheme> <cbc:ID>VAT</cbc:ID> </cac:TaxScheme> </cac:PartyTaxScheme> <cac:PartyLegalEntity> <cbc:RegistrationName>Haji Husein Alireza Co. Ltd</cbc:RegistrationName> </cac:PartyLegalEntity> </cac:Party> </cac:AccountingSupplierParty> <cac:AccountingCustomerParty> <cac:Party> <cac:PartyIdentification> <cbc:ID schemeID="SAG">123C12345678</cbc:ID> </cac:PartyIdentification> <cac:PostalAddress> <cbc:StreetName>King Abdullah Road</cbc:StreetName> <cbc:BuildingNumber>3709</cbc:BuildingNumber> <cbc:PlotIdentification>1004</cbc:PlotIdentification> <cbc:CitySubdivisionName>Al Mursalat</cbc:CitySubdivisionName> <cbc:CityName>Riyadh</cbc:CityName> <cbc:PostalZone>11564</cbc:PostalZone> <cbc:CountrySubentity>Riyadh Region</cbc:CountrySubentity> <cac:Country> <cbc:IdentificationCode>SA</cbc:IdentificationCode> </cac:Country> </cac:PostalAddress> <cac:PartyTaxScheme> <cac:TaxScheme> <cbc:ID>VAT</cbc:ID> </cac:TaxScheme> </cac:PartyTaxScheme> <cac:PartyLegalEntity> <cbc:RegistrationName>AL KAWTHAR MARKETS</cbc:RegistrationName> </cac:PartyLegalEntity> </cac:Party> </cac:AccountingCustomerParty> <cac:Delivery> <cbc:ActualDeliveryDate>2022-04-25</cbc:ActualDeliveryDate> </cac:Delivery> <cac:PaymentMeans> <cbc:PaymentMeansCode>42</cbc:PaymentMeansCode> </cac:PaymentMeans> <cac:TaxTotal> <cbc:TaxAmount currencyID="SAR">135.00</cbc:TaxAmount> <cac:TaxSubtotal> <cbc:TaxableAmount currencyID="SAR">900.00</cbc:TaxableAmount> <cbc:TaxAmount currencyID="SAR">135.00</cbc:TaxAmount> <cac:TaxCategory> <cbc:ID>S</cbc:ID> <cbc:Percent>15</cbc:Percent> <cac:TaxScheme> <cbc:ID>VAT</cbc:ID> </cac:TaxScheme> </cac:TaxCategory> </cac:TaxSubtotal> </cac:TaxTotal> <cac:TaxTotal> <cbc:TaxAmount currencyID="SAR">135.00</cbc:TaxAmount> </cac:TaxTotal> <cac:LegalMonetaryTotal> <cbc:LineExtensionAmount currencyID="SAR">900.00</cbc:LineExtensionAmount> <cbc:TaxExclusiveAmount currencyID="SAR">900.00</cbc:TaxExclusiveAmount> <cbc:TaxInclusiveAmount currencyID="SAR">1035.00</cbc:TaxInclusiveAmount> <cbc:AllowanceTotalAmount currencyID="SAR">0.00</cbc:AllowanceTotalAmount> <cbc:PayableAmount currencyID="SAR">1035.00</cbc:PayableAmount> </cac:LegalMonetaryTotal> <cac:InvoiceLine> <cbc:ID>1</cbc:ID> <cbc:InvoicedQuantity unitCode="PCE">1</cbc:InvoicedQuantity> <cbc:LineExtensionAmount currencyID="SAR">200.00</cbc:LineExtensionAmount> <cac:TaxTotal> <cbc:TaxAmount currencyID="SAR">30.00</cbc:TaxAmount> <cbc:RoundingAmount currencyID="SAR">230.00</cbc:RoundingAmount> </cac:TaxTotal> <cac:Item> <cbc:Name>Item A</cbc:Name> <cac:ClassifiedTaxCategory> <cbc:ID>S</cbc:ID> <cbc:Percent>15</cbc:Percent> <cac:TaxScheme> <cbc:ID>VAT</cbc:ID> </cac:TaxScheme> </cac:ClassifiedTaxCategory> </cac:Item> <cac:Price> <cbc:PriceAmount currencyID="SAR">200.00</cbc:PriceAmount> </cac:Price> </cac:InvoiceLine> <cac:InvoiceLine> <cbc:ID>2</cbc:ID> <cbc:InvoicedQuantity unitCode="PCE">2</cbc:InvoicedQuantity> <cbc:LineExtensionAmount currencyID="SAR">700.00</cbc:LineExtensionAmount> <cac:TaxTotal> <cbc:TaxAmount currencyID="SAR">105.00</cbc:TaxAmount> <cbc:RoundingAmount currencyID="SAR">805.00</cbc:RoundingAmount> </cac:TaxTotal> <cac:Item> <cbc:Name>Item B</cbc:Name> <cac:ClassifiedTaxCategory> <cbc:ID>S</cbc:ID> <cbc:Percent>15</cbc:Percent> <cac:TaxScheme> <cbc:ID>VAT</cbc:ID> </cac:TaxScheme> </cac:ClassifiedTaxCategory> </cac:Item> <cac:Price> <cbc:PriceAmount currencyID="SAR">350.00</cbc:PriceAmount> </cac:Price> </cac:InvoiceLine> </Invoice>';


--cb2:= '<Invoice xmlns="urn:oasis:names:specification:ubl:schema:xsd:Invoice-2" xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2" xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2" xmlns:ext="urn:oasis:names:specification:ubl:schema:xsd:CommonExtensionComponents-2"> <cbc:ProfileID>reporting:1.0</cbc:ProfileID> <cbc:ID>100</cbc:ID> <cbc:UUID>3cf5ee18-ee25-44ea-a444-2c37ba7f28be</cbc:UUID> <cbc:IssueDate>2021-04-25</cbc:IssueDate> <cbc:IssueTime>15:30:00</cbc:IssueTime> <cbc:InvoiceTypeCode name="0100000">388</cbc:InvoiceTypeCode> <cbc:DocumentCurrencyCode>SAR</cbc:DocumentCurrencyCode> <cbc:TaxCurrencyCode>SAR</cbc:TaxCurrencyCode> <cbc:LineCountNumeric>2</cbc:LineCountNumeric> <cac:AdditionalDocumentReference> <cbc:ID>ICV</cbc:ID> <cbc:UUID>46531</cbc:UUID> </cac:AdditionalDocumentReference> <cac:AdditionalDocumentReference> <cbc:ID>PIH</cbc:ID> <cac:Attachment> <cbc:EmbeddedDocumentBinaryObject mimeCode="text/plain">NWZlY2ViNjZmZmM4NmYzOGQ5NTI3ODZjNmQ2OTZjNzljMmRiYzIzOWRkNGU5MWI0NjcyOWQ3M2EyN2ZiNTdlOQ==</cbc:EmbeddedDocumentBinaryObject> </cac:Attachment> </cac:AdditionalDocumentReference> <cac:AccountingSupplierParty> <cac:Party> <cac:PartyIdentification> <cbc:ID schemeID="MLS">123457890</cbc:ID> </cac:PartyIdentification> <cac:PostalAddress> <cbc:StreetName>Bab makkah</cbc:StreetName> <cbc:BuildingNumber>1234</cbc:BuildingNumber> <cbc:PlotIdentification>1234</cbc:PlotIdentification> <cbc:CitySubdivisionName>Bab Makkah</cbc:CitySubdivisionName> <cbc:CityName>Jeddah</cbc:CityName> <cbc:PostalZone>12643</cbc:PostalZone> <cbc:CountrySubentity>Makkah Region</cbc:CountrySubentity> <cac:Country> <cbc:IdentificationCode>SA</cbc:IdentificationCode> </cac:Country> </cac:PostalAddress> <cac:PartyTaxScheme> <cbc:CompanyID>312345678900003</cbc:CompanyID> <cac:TaxScheme> <cbc:ID>VAT</cbc:ID> </cac:TaxScheme> </cac:PartyTaxScheme> <cac:PartyLegalEntity> <cbc:RegistrationName>Haji Husein Alireza Co. Ltd</cbc:RegistrationName> </cac:PartyLegalEntity> </cac:Party> </cac:AccountingSupplierParty> <cac:AccountingCustomerParty> <cac:Party> <cac:PartyIdentification> <cbc:ID schemeID="SAG">123C12345678</cbc:ID> </cac:PartyIdentification> <cac:PostalAddress> <cbc:StreetName>King Abdullah Road</cbc:StreetName> <cbc:BuildingNumber>3709</cbc:BuildingNumber> <cbc:PlotIdentification>1004</cbc:PlotIdentification> <cbc:CitySubdivisionName>Al Mursalat</cbc:CitySubdivisionName> <cbc:CityName>Riyadh</cbc:CityName> <cbc:PostalZone>11564</cbc:PostalZone> <cbc:CountrySubentity>Riyadh Region</cbc:CountrySubentity> <cac:Country> <cbc:IdentificationCode>SA</cbc:IdentificationCode> </cac:Country> </cac:PostalAddress> <cac:PartyTaxScheme> <cac:TaxScheme> <cbc:ID>VAT</cbc:ID> </cac:TaxScheme> </cac:PartyTaxScheme> <cac:PartyLegalEntity> <cbc:RegistrationName>AL KAWTHAR MARKETS</cbc:RegistrationName> </cac:PartyLegalEntity> </cac:Party> </cac:AccountingCustomerParty> <cac:Delivery> <cbc:ActualDeliveryDate>2022-04-25</cbc:ActualDeliveryDate> </cac:Delivery> <cac:PaymentMeans> <cbc:PaymentMeansCode>42</cbc:PaymentMeansCode> </cac:PaymentMeans> <cac:TaxTotal> <cbc:TaxAmount currencyID="SAR">135.00</cbc:TaxAmount> <cac:TaxSubtotal> <cbc:TaxableAmount currencyID="SAR">900.00</cbc:TaxableAmount> <cbc:TaxAmount currencyID="SAR">135.00</cbc:TaxAmount> <cac:TaxCategory> <cbc:ID>S</cbc:ID> <cbc:Percent>15</cbc:Percent> <cac:TaxScheme> <cbc:ID>VAT</cbc:ID> </cac:TaxScheme> </cac:TaxCategory> </cac:TaxSubtotal> </cac:TaxTotal> <cac:TaxTotal> <cbc:TaxAmount currencyID="SAR">135.00</cbc:TaxAmount> </cac:TaxTotal> <cac:LegalMonetaryTotal> <cbc:LineExtensionAmount currencyID="SAR">900.00</cbc:LineExtensionAmount> <cbc:TaxExclusiveAmount currencyID="SAR">900.00</cbc:TaxExclusiveAmount> <cbc:TaxInclusiveAmount currencyID="SAR">1035.00</cbc:TaxInclusiveAmount> <cbc:AllowanceTotalAmount currencyID="SAR">0.00</cbc:AllowanceTotalAmount> <cbc:PayableAmount currencyID="SAR">1035.00</cbc:PayableAmount> </cac:LegalMonetaryTotal> <cac:InvoiceLine> <cbc:ID>1</cbc:ID> <cbc:InvoicedQuantity unitCode="PCE">1</cbc:InvoicedQuantity> <cbc:LineExtensionAmount currencyID="SAR">200.00</cbc:LineExtensionAmount> <cac:TaxTotal> <cbc:TaxAmount currencyID="SAR">30.00</cbc:TaxAmount> <cbc:RoundingAmount currencyID="SAR">230.00</cbc:RoundingAmount> </cac:TaxTotal> <cac:Item> <cbc:Name>Item A</cbc:Name> <cac:ClassifiedTaxCategory> <cbc:ID>S</cbc:ID> <cbc:Percent>15</cbc:Percent> <cac:TaxScheme> <cbc:ID>VAT</cbc:ID> </cac:TaxScheme> </cac:ClassifiedTaxCategory> </cac:Item> <cac:Price> <cbc:PriceAmount currencyID="SAR">200.00</cbc:PriceAmount> </cac:Price> </cac:InvoiceLine> <cac:InvoiceLine> <cbc:ID>2</cbc:ID> <cbc:InvoicedQuantity unitCode="PCE">2</cbc:InvoicedQuantity> <cbc:LineExtensionAmount currencyID="SAR">700.00</cbc:LineExtensionAmount> <cac:TaxTotal> <cbc:TaxAmount currencyID="SAR">105.00</cbc:TaxAmount> <cbc:RoundingAmount currencyID="SAR">805.00</cbc:RoundingAmount> </cac:TaxTotal> <cac:Item> <cbc:Name>Item B</cbc:Name> <cac:ClassifiedTaxCategory> <cbc:ID>S</cbc:ID> <cbc:Percent>15</cbc:Percent> <cac:TaxScheme> <cbc:ID>VAT</cbc:ID> </cac:TaxScheme> </cac:ClassifiedTaxCategory> </cac:Item> <cac:Price> <cbc:PriceAmount currencyID="SAR">350.00</cbc:PriceAmount> </cac:Price> </cac:InvoiceLine> </Invoice>';


--cb2:= '<Invoice xmlns="urn:oasis:names:specification:ubl:schema:xsd:Invoice-2" xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2" xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2" xmlns:ext="urn:oasis:names:specification:ubl:schema:xsd:CommonExtensionComponents-2"> <cbc:ProfileID>reporting:1.0</cbc:ProfileID> <cbc:ID>100</cbc:ID> <cbc:UUID>3cf5ee18-ee25-44ea-a444-2c37ba7f28be</cbc:UUID> <cbc:IssueDate>2021-04-25</cbc:IssueDate> <cbc:IssueTime>15:30:00</cbc:IssueTime> <cbc:InvoiceTypeCode name="0100000">388</cbc:InvoiceTypeCode> <cbc:DocumentCurrencyCode>SAR</cbc:DocumentCurrencyCode> <cbc:TaxCurrencyCode>SAR</cbc:TaxCurrencyCode> <cbc:LineCountNumeric>2</cbc:LineCountNumeric> <cac:AdditionalDocumentReference> <cbc:ID>ICV</cbc:ID> <cbc:UUID>46531</cbc:UUID> </cac:AdditionalDocumentReference> <cac:AdditionalDocumentReference> <cbc:ID>PIH</cbc:ID> <cac:Attachment> <cbc:EmbeddedDocumentBinaryObject mimeCode="text/plain">NWZlY2ViNjZmZmM4NmYzOGQ5NTI3ODZjNmQ2OTZjNzljMmRiYzIzOWRkNGU5MWI0NjcyOWQ3M2EyN2ZiNTdlOQ==</cbc:EmbeddedDocumentBinaryObject> </cac:Attachment> </cac:AdditionalDocumentReference> <cac:AccountingSupplierParty> <cac:Party> <cac:PartyIdentification> <cbc:ID schemeID="MLS">123457890</cbc:ID> </cac:PartyIdentification> <cac:PostalAddress> <cbc:StreetName>Bab makkah</cbc:StreetName> <cbc:BuildingNumber>1234</cbc:BuildingNumber> <cbc:PlotIdentification>1234</cbc:PlotIdentification> <cbc:CitySubdivisionName>Bab Makkah</cbc:CitySubdivisionName> <cbc:CityName>Jeddah</cbc:CityName> <cbc:PostalZone>12643</cbc:PostalZone> <cbc:CountrySubentity>Makkah Region</cbc:CountrySubentity> <cac:Country> <cbc:IdentificationCode>SA</cbc:IdentificationCode> </cac:Country> </cac:PostalAddress> <cac:PartyTaxScheme> <cbc:CompanyID>312345678900003</cbc:CompanyID> <cac:TaxScheme> <cbc:ID>VAT</cbc:ID> </cac:TaxScheme> </cac:PartyTaxScheme> <cac:PartyLegalEntity> <cbc:RegistrationName>Haji Husein Alireza Co. Ltd</cbc:RegistrationName> </cac:PartyLegalEntity> </cac:Party> </cac:AccountingSupplierParty> <cac:AccountingCustomerParty> <cac:Party> <cac:PartyIdentification> <cbc:ID schemeID="SAG">123C12345678</cbc:ID> </cac:PartyIdentification> <cac:PostalAddress> <cbc:StreetName>King Abdullah Road</cbc:StreetName> <cbc:BuildingNumber>3709</cbc:BuildingNumber> <cbc:PlotIdentification>1004</cbc:PlotIdentification> <cbc:CitySubdivisionName>Al Mursalat</cbc:CitySubdivisionName> <cbc:CityName>Riyadh</cbc:CityName> <cbc:PostalZone>11564</cbc:PostalZone> <cbc:CountrySubentity>Riyadh Region</cbc:CountrySubentity> <cac:Country> <cbc:IdentificationCode>SA</cbc:IdentificationCode> </cac:Country> </cac:PostalAddress> <cac:PartyTaxScheme> <cac:TaxScheme> <cbc:ID>VAT</cbc:ID> </cac:TaxScheme> </cac:PartyTaxScheme> <cac:PartyLegalEntity> <cbc:RegistrationName>AL KAWTHAR MARKETS</cbc:RegistrationName> </cac:PartyLegalEntity> </cac:Party> </cac:AccountingCustomerParty> <cac:Delivery> <cbc:ActualDeliveryDate>2022-04-25</cbc:ActualDeliveryDate> </cac:Delivery> <cac:PaymentMeans> <cbc:PaymentMeansCode>42</cbc:PaymentMeansCode> </cac:PaymentMeans> <cac:TaxTotal> <cbc:TaxAmount currencyID="SAR">135.00</cbc:TaxAmount> <cac:TaxSubtotal> <cbc:TaxableAmount currencyID="SAR">900.00</cbc:TaxableAmount> <cbc:TaxAmount currencyID="SAR">135.00</cbc:TaxAmount> <cac:TaxCategory> <cbc:ID>S</cbc:ID> <cbc:Percent>15</cbc:Percent> <cac:TaxScheme> <cbc:ID>VAT</cbc:ID> </cac:TaxScheme> </cac:TaxCategory> </cac:TaxSubtotal> </cac:TaxTotal> <cac:TaxTotal> <cbc:TaxAmount currencyID="SAR">135.00</cbc:TaxAmount> </cac:TaxTotal> <cac:LegalMonetaryTotal> <cbc:LineExtensionAmount currencyID="SAR">900.00</cbc:LineExtensionAmount> <cbc:TaxExclusiveAmount currencyID="SAR">900.00</cbc:TaxExclusiveAmount> <cbc:TaxInclusiveAmount currencyID="SAR">1035.00</cbc:TaxInclusiveAmount> <cbc:AllowanceTotalAmount currencyID="SAR">0.00</cbc:AllowanceTotalAmount> <cbc:PayableAmount currencyID="SAR">1035.00</cbc:PayableAmount> </cac:LegalMonetaryTotal> <cac:InvoiceLine> <cbc:ID>1</cbc:ID> <cbc:InvoicedQuantity unitCode="PCE">1</cbc:InvoicedQuantity> <cbc:LineExtensionAmount currencyID="SAR">200.00</cbc:LineExtensionAmount> <cac:TaxTotal> <cbc:TaxAmount currencyID="SAR">30.00</cbc:TaxAmount> <cbc:RoundingAmount currencyID="SAR">230.00</cbc:RoundingAmount> </cac:TaxTotal> <cac:Item> <cbc:Name>Item A</cbc:Name> <cac:ClassifiedTaxCategory> <cbc:ID>S</cbc:ID> <cbc:Percent>15</cbc:Percent> <cac:TaxScheme> <cbc:ID>VAT</cbc:ID> </cac:TaxScheme> </cac:ClassifiedTaxCategory> </cac:Item> <cac:Price> <cbc:PriceAmount currencyID="SAR">200.00</cbc:PriceAmount> </cac:Price> </cac:InvoiceLine> <cac:InvoiceLine> <cbc:ID>2</cbc:ID> <cbc:InvoicedQuantity unitCode="PCE">2</cbc:InvoicedQuantity> <cbc:LineExtensionAmount currencyID="SAR">700.00</cbc:LineExtensionAmount> <cac:TaxTotal> <cbc:TaxAmount currencyID="SAR">105.00</cbc:TaxAmount> <cbc:RoundingAmount currencyID="SAR">805.00</cbc:RoundingAmount> </cac:TaxTotal> <cac:Item> <cbc:Name>Item B</cbc:Name> <cac:ClassifiedTaxCategory> <cbc:ID>S</cbc:ID> <cbc:Percent>15</cbc:Percent> <cac:TaxScheme> <cbc:ID>VAT</cbc:ID> </cac:TaxScheme> </cac:ClassifiedTaxCategory> </cac:Item> <cac:Price> <cbc:PriceAmount currencyID="SAR">350.00</cbc:PriceAmount> </cac:Price> </cac:InvoiceLine> </Invoice>';

--select xmlserialize( content   xmlagg(xmltype(cb2)) as clob  ) into cb1 from dual;
select xml into cb2 from zatca_xml;

select xmlserialize( Document  xmltype(cb2) as clob NO INDENT ) into cb1 from dual;
cb := trim(regexp_replace(cb1,'><', '> <'));
--cb := cb2;


--h := dbms_crypto.hash(cb, dbms_crypto.hash_sh256);
h := dbms_crypto.hash(utl_i18n.string_to_raw (cb, 'AL32UTF8'), dbms_crypto.hash_sh256);
RETURN utl_raw.cast_to_varchar2(UTL_ENCODE.BASE64_ENCODE(h));


END;
/]]></n0:source>
		</n0:createOracleFunction>
	</changeSet>
</databaseChangeLog>
